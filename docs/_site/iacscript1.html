<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Security Group / Rule Powershell Script | My IT Docs</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Security Group / Rule Powershell Script" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/iacscript1.html" /> <meta property="og:url" content="http://localhost:4000/iacscript1.html" /> <meta property="og:site_name" content="My IT Docs" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Security Group / Rule Powershell Script" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Security Group / Rule Powershell Script","url":"http://localhost:4000/iacscript1.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> My IT Docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/active_directory_local.html" class="nav-list-link">Active Directory</a></li><li class="nav-list-item"><a href="/azure.html" class="nav-list-link">Azure</a></li><li class="nav-list-item"><a href="/powershell.html" class="nav-list-link">PowerShell</a></li><li class="nav-list-item"><a href="/dictionary.html" class="nav-list-link">PowerShell</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search My IT Docs" aria-label="Search My IT Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="security-group--rule-powershell-script"> <a href="#security-group--rule-powershell-script" class="anchor-heading" aria-labelledby="security-group--rule-powershell-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Group / Rule Powershell Script </h1> <p><a href="/azure.html">Back to Azure</a> <a href="/sec_groups_iac.html">Back to Sec Groups</a></p><hr /> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># deploy </span><span class="w">

</span><span class="c">#specialized to secGroup but lets leave it for now.</span><span class="w">
</span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$resourceGroupName</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$filePath</span><span class="p">,</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$scriptType</span><span class="w">
    
</span><span class="p">)</span><span class="w">

</span><span class="nv">$mainInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">

</span><span class="c"># Set a class to work as a struct but may have not needed the indexing</span><span class="w">
</span><span class="kr">class</span><span class="w"> </span><span class="nc">CmdValue</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$value</span><span class="w">
    </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$index</span><span class="w">

    </span><span class="n">CmdValue</span><span class="p">([</span><span class="n">string</span><span class="p">]</span><span class="nv">$value</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="bp">$this</span><span class="o">.</span><span class="nf">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$value</span><span class="w">
        </span><span class="bp">$this</span><span class="o">.</span><span class="nf">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$index</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c"># function to getInput for a value(param)</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">getInput</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$value</span><span class="p">,</span><span class="w">
        </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$index</span><span class="w">
    </span><span class="p">)</span><span class="w">

    </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">
    </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"y"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$confirm</span><span class="o">.</span><span class="nf">ToLower</span><span class="p">()</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$userValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter value for </span><span class="nv">$value</span><span class="s2">"</span><span class="w">
        </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Confirm: </span><span class="nv">$value</span><span class="s2"> = </span><span class="nv">$userValue</span><span class="s2">, Enter y or yes"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nv">$commandValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">CmdValue</span><span class="p">]::</span><span class="n">new</span><span class="p">(</span><span class="nv">$userValue</span><span class="p">,</span><span class="w"> </span><span class="nv">$index</span><span class="p">)</span><span class="w">

    </span><span class="kr">return</span><span class="w"> </span><span class="nv">$commandValue</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># For the help function</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">printOptions</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">CmdValue</span><span class="p">[]]</span><span class="nv">$arr</span><span class="w">
    </span><span class="p">)</span><span class="w">
    </span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$arr</span><span class="o">.</span><span class="nf">Length</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"</span><span class="nv">$i</span><span class="s2">."</span><span class="w"> </span><span class="nv">$arr</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">.</span><span class="nf">value</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># changing choices of your list this works for any length</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">changeChoices</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">CmdValue</span><span class="p">[]]</span><span class="nv">$arr</span><span class="w">
    </span><span class="p">)</span><span class="w">
    </span><span class="nv">$len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$arr</span><span class="o">.</span><span class="nf">Length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="nv">$exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter value to change? Enter exit to quit."</span><span class="w">
    
    </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$exit</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"exit"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$exit</span><span class="w"> </span><span class="nt">-notin</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="nv">$len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter a value in range. Or enter exit to quit"</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$exit</span><span class="w">
            </span><span class="nv">$index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$arr</span><span class="p">[</span><span class="nv">$exit</span><span class="p">]</span><span class="o">.</span><span class="nf">value</span><span class="w">
            </span><span class="nv">$newValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter new value for </span><span class="nv">$index</span><span class="s2"> :"</span><span class="w">
            </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">
            </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Confirm </span><span class="nv">$newValue</span><span class="s2"> as new value? y/yes or no"</span><span class="w">
                </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"y"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nv">$arr</span><span class="p">[</span><span class="nv">$exit</span><span class="p">]</span><span class="o">.</span><span class="nf">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$newValue</span><span class="w">
                    </span><span class="kr">break</span><span class="w">
                </span><span class="p">}</span><span class="w">
                </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Not confirmed...."</span><span class="w">
                    </span><span class="kr">break</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"y"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="kr">break</span><span class="w">
            </span><span class="p">}</span><span class="w"> 
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">return</span><span class="w"> </span><span class="nv">$arr</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># declaring the read input functions</span><span class="w">

</span><span class="nv">$secRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Security Group Rule"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">0</span><span class="w">
</span><span class="nv">$desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Description"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">1</span><span class="w">
</span><span class="nv">$proto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Protocol"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">2</span><span class="w">
</span><span class="nv">$destPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Destination Port Range"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">3</span><span class="w">
</span><span class="nv">$sourceAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Source IP Address"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">4</span><span class="w">
</span><span class="nv">$access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Access"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">5</span><span class="w">
</span><span class="nv">$direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Direction"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">6</span><span class="w">


</span><span class="c"># a list of the commands (could) be improved</span><span class="w">
</span><span class="nv">$cmdList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="nv">$secRule</span><span class="w">
    </span><span class="nv">$desc</span><span class="w">
    </span><span class="nv">$proto</span><span class="w">
    </span><span class="nv">$destPort</span><span class="w">
    </span><span class="nv">$sourceAddress</span><span class="w">
    </span><span class="nv">$access</span><span class="w">
    </span><span class="nv">$direction</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c"># checking param</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$scriptType</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInput</span><span class="w"> </span><span class="nt">-value</span><span class="w"> </span><span class="s2">"Priority"</span><span class="w"> </span><span class="nt">-index</span><span class="w"> </span><span class="nx">7</span><span class="w">
    </span><span class="nv">$cmdList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$priority</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c"># Main loop to run the cli tool and get all the information</span><span class="w">
</span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">
</span><span class="nv">$exitCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">
</span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"y"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"yes"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"exit"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
   
   </span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Confirm these values y or yes and h or help to reprint"</span><span class="w">
   </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"h"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"help"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Values:"</span><span class="w">
    </span><span class="n">printOptions</span><span class="w"> </span><span class="nt">-arr</span><span class="w"> </span><span class="nv">$cmdList</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"y"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$superConfirm</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s2">"yes"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
   
    </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$exitCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Would you like to exit, or edit your values?"</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$exitCheck</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"exit"</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$exitCheck</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"edit"</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="kr">break</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Please Enter Exit or Edit"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$exitCheck</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"edit"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Edititing"</span><span class="w">
        </span><span class="nv">$newArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">changeChoices</span><span class="w"> </span><span class="nt">-arr</span><span class="w"> </span><span class="nv">$cmdList</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Exiting"</span><span class="w">
        </span><span class="nv">$newArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$cmdList</span><span class="w">
        </span><span class="kr">break</span><span class="w">
    </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">continue</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># to be packaged into a param object</span><span class="w">
</span><span class="nv">$params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="nx">secRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">proto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">sourceip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
    </span><span class="nx">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="err">.</span><span class="nx">value</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$scriptType</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$params</span><span class="p">[</span><span class="s2">"priority"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$newArr</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="nf">value</span><span class="w">
    
</span><span class="p">}</span><span class="w">

</span><span class="c"># Try to deploy</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">New-AzResourceGroupDeployment</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-ResourceGroupName</span><span class="w"> </span><span class="nv">$resourceGroupName</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-TemplateFile</span><span class="w"> </span><span class="nv">$filePath</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-TemplateParameterObject</span><span class="w"> </span><span class="nv">$params</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Exception</span><span class="o">.</span><span class="nf">Message</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div><hr /> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
